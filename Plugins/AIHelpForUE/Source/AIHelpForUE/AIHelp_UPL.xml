<?xml version="1.0" encoding="utf-8"?>
<root xmlns:android="http://schemas.android.com/apk/res/android">

    <gameActivityImportAdditions>
        <insert>
			import net.aihelp.config.UserConfig;
			import net.aihelp.config.enums.PublishCountryOrRegion;
			import net.aihelp.config.enums.PushPlatform;
			import net.aihelp.config.ConversationConfig;
			import net.aihelp.config.FaqConfig;
			import net.aihelp.config.OperationConfig;
			import net.aihelp.config.enums.ConversationIntent;
			import net.aihelp.config.enums.ShowConversationMoment;
			import net.aihelp.exception.AIHelpInitException;
			import net.aihelp.init.AIHelpSupport;
			import net.aihelp.ui.listener.OnAIHelpInitializedCallback;
			import net.aihelp.ui.listener.OnAIHelpSessionCloseCallback;
			import net.aihelp.ui.listener.OnAIHelpSessionOpenCallback;
			import net.aihelp.ui.listener.OnMessageCountArrivedCallback;
			import net.aihelp.ui.listener.OnNetworkCheckResultCallback;
			import net.aihelp.ui.listener.OnSpecificFormSubmittedCallback;
			import net.aihelp.ui.listener.OnSpecificUrlClickedCallback;
			import net.aihelp.ui.listener.OnNetworkCheckResultCallback;
			import net.aihelp.init.CallbackHelper;
        </insert>
    </gameActivityImportAdditions>

    <buildGradleAdditions>
        <insert>
            android {
				compileOptions {
					sourceCompatibility 1.8
					targetCompatibility 1.8
				}
            }
            dependencies {
            	implementation 'net.aihelp:android-aihelp-aar:3.3.9'
            }
        </insert>
    </buildGradleAdditions>

    <gameActivityOnCreateAdditions>
        <insert>
        </insert>
    </gameActivityOnCreateAdditions>

    <gameActivityClassAdditions>
        <insert>
			public native void nativeOnAIHelpInitializedCallback(boolean success, String msg);

			public native void nativeOnAIHelpUnreadMessageArrivedCallback(int unreadMessageCount);

			public native void nativeOnAIHelpSpecificUrlClickedCallback(String url);

			public native void nativeOnAIHelpSpecificFormSubmittedCallback();

			public native void nativeOnAIHelpSessionOpenCallback();

			public native void nativeOnAIHelpSessionCloseCallback();

			public native void nativeSetNetworkCheckHostAddress(String netLog);

			public void AIHelpInit(String appKey, String domain, String appId, String language) {
				try {
					AIHelpSupport.init(this, appKey, domain, appId, language);
				} catch (AIHelpInitException e) {
					nativeOnAIHelpInitializedCallback(false, e.getMessage());
				}
			}

			public void AIHelpSetOnAIHelpInitializedCallback() {
				AIHelpSupport.setOnAIHelpInitializedCallback(new OnAIHelpInitializedCallback() {
					@Override
					public void onAIHelpInitialized() {
						nativeOnAIHelpInitializedCallback(true, "");
					}
				});
			}			
			
			public void AIHelpStartUnreadMessageCountPolling() {
				AIHelpSupport.startUnreadMessageCountPolling(new OnMessageCountArrivedCallback() {
					@Override
					public void onMessageCountArrived(int msgCount) {
						nativeOnAIHelpUnreadMessageArrivedCallback(msgCount);
					}
				});
			}			
			
			public void AIHelpSetOnSpecificFormSubmittedCallback() {
				AIHelpSupport.setOnSpecificFormSubmittedCallback(new OnSpecificFormSubmittedCallback() {
					@Override
					public void onFormSubmitted() {
						nativeOnAIHelpSpecificFormSubmittedCallback();
					}
				});
			}
			
			public void AIHelpSetOnAIHelpSessionOpenCallback() {
				AIHelpSupport.setOnAIHelpSessionOpenCallback(new OnAIHelpSessionOpenCallback() {
					@Override
					public void onAIHelpSessionOpened() {
						nativeOnAIHelpSessionOpenCallback();
					}
				});
			}
			
			public void AIHelpSetOnAIHelpSessionCloseCallback() {
				AIHelpSupport.setOnAIHelpSessionCloseCallback(new OnAIHelpSessionCloseCallback() {
					@Override
					public void onAIHelpSessionClosed() {
						nativeOnAIHelpSessionCloseCallback();
					}
				});
			}
		
			public void AIHelpSetOnSpecificUrlClickedCallback() {
				AIHelpSupport.setOnSpecificUrlClickedCallback(new OnSpecificUrlClickedCallback() {
					@Override
					public void onSpecificUrlClicked(String url) {
						nativeOnAIHelpSpecificUrlClickedCallback(url);
					}
				});
			}

			private ConversationConfig getConversationConfig(int conversationIntent, boolean alwaysShowHuman,
			String welcomeMessage, String storyNode) {
				ConversationIntent intent = conversationIntent == 1 ? ConversationIntent.BOT_SUPPORT : ConversationIntent.HUMAN_SUPPORT;
				ConversationConfig.Builder builder = new ConversationConfig.Builder()
					.setConversationIntent(intent)
					.setAlwaysShowHumanSupportButtonInBotPage(alwaysShowHuman)
					.setWelcomeMessage(welcomeMessage)
					.setStoryNode(storyNode);
				return builder.build();
			}

			private FaqConfig getFaqConfig(int showConversationMoment, int conversationIntent,
				boolean alwaysShowHuman, String welcomeMessage, String storyNode) {
				ShowConversationMoment showMoment = ShowConversationMoment.NEVER;
				switch (showConversationMoment) {
					case 0:
						showMoment = ShowConversationMoment.NEVER;
						break;
					case 1:
						showMoment = ShowConversationMoment.ALWAYS;
						break;
					case 2:
						showMoment = ShowConversationMoment.ONLY_IN_ANSWER_PAGE;
						break;
					case 3:
						showMoment = ShowConversationMoment.AFTER_MARKING_UNHELPFUL;
						break;
					default:
						break;
				}
				ConversationConfig conversationConfig = getConversationConfig(conversationIntent, alwaysShowHuman, welcomeMessage, storyNode);
				FaqConfig.Builder faqConfig = new FaqConfig.Builder().setShowConversationMoment(showMoment)
					.setConversationConfig(conversationConfig);
				return faqConfig.build();
			}

			public void AIHelpShowConversation(int conversationIntent, boolean alwaysShowHuman,
							String welcomeMessage, String storyNode) {
				AIHelpSupport.showConversation(getConversationConfig(conversationIntent, alwaysShowHuman, welcomeMessage, storyNode));
			}

			public void AIHelpShowAllFAQSections(int showConversationMoment, int conversationIntent,
						boolean alwaysShowHuman, String welcomeMessage, String storyNode) {
				FaqConfig faqConfig = getFaqConfig(showConversationMoment, conversationIntent, alwaysShowHuman, welcomeMessage, storyNode);
				AIHelpSupport.showAllFAQSections(faqConfig);
			}

			public void AIHelpShowFAQSection(String sectionId, int showConversationMoment, int conversationIntent,
						boolean alwaysShowHuman, String welcomeMessage, String storyNode) {
				FaqConfig faqConfig = getFaqConfig(showConversationMoment, conversationIntent,
						alwaysShowHuman, welcomeMessage, storyNode);
				AIHelpSupport.showFAQSection(sectionId, faqConfig);
			}

			public void AIHelpShowSingleFAQ(String faqId, int showConversationMoment, int conversationIntent,
						boolean alwaysShowHuman, String welcomeMessage, String storyNode) {
				FaqConfig faqConfig = getFaqConfig(showConversationMoment, conversationIntent,
					alwaysShowHuman, welcomeMessage, storyNode);
				AIHelpSupport.showSingleFAQ(faqId, faqConfig);
			}

			public void AIHelpShowOperation(int selectIndex, String conversationTitle, int conversationIntent,
						boolean alwaysShowHuman, String welcomeMessage, String storyNode) {
				OperationConfig operationConfig = new OperationConfig.Builder()
					.setSelectIndex(selectIndex)
					.setConversationTitle(conversationTitle)
					.setConversationConfig(getConversationConfig(conversationIntent, alwaysShowHuman, welcomeMessage, storyNode))
					.build();
				AIHelpSupport.showOperation(operationConfig);
			}

			public void AIHelpSetNetworkCheckHostAddress(String hostAddress) {
				AIHelpSupport.setNetworkCheckHostAddress(hostAddress, new OnNetworkCheckResultCallback() {
					@Override
					public void onNetworkCheckResult(String netLog) {
						nativeSetNetworkCheckHostAddress(netLog);
					}
				});
			}

			public void AIHelpUpdateUserInfo(String userId, String userName, String serverId, String userTags, String customData, boolean isSyncCrmInfo) {
				UserConfig userConfig = new UserConfig.Builder()
					.setUserId(userId)
					.setUserName(userName)
					.setServerId(serverId)
					.setUserTags(userTags)
					.setCustomData(customData)
					.setSyncCrmInfo(isSyncCrmInfo)
					.build();
				AIHelpSupport.updateUserInfo(userConfig);
			}

			public void AIHelpResetUserInfo() {
				AIHelpSupport.resetUserInfo();
			}

			public void AIHelpUpdateSDKLanguage(String language) {
				AIHelpSupport.updateSDKLanguage(language);
			}

			public void AIHelpSetPushTokenAndPlatform(String pushToken, int pushPlatform) {
				AIHelpSupport.setPushTokenAndPlatform(pushToken, PushPlatform.fromValue(pushPlatform));
			}

			public void AIHelpSetUploadLogPath(String logPath) {
				AIHelpSupport.setUploadLogPath(logPath);
			}

			public String AIHelpGetSDKVersion() {
				return AIHelpSupport.getSDKVersion();
			}

			public boolean AIHelpIsAIHelpShowing() {
				return AIHelpSupport.isAIHelpShowing();
			}

			public void AIHelpEnableLogging(boolean enable) {
				AIHelpSupport.enableLogging(enable);
			}

			public void AIHelpShowUrl(String url) {
				AIHelpSupport.showUrl(url);
			}

			public void AIHelpAdditionalSupportFor(int countryOrRegion) {
				AIHelpSupport.additionalSupportFor(PublishCountryOrRegion.fromValue(countryOrRegion));
			}
			
        </insert>
    </gameActivityClassAdditions>
</root>